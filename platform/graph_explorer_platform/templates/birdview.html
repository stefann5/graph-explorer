<script>

    var miniMapLinks;
    var miniMapNodes;
    var miniMap;
    var isMiniMapScaled = false;

    function initializeMiniMap(links, force) {
        d3.select("#bird-view").selectAll("svg").remove();
        miniMap = d3.select("#bird-view")
            .append("svg")
            .attr("opacity", 0)
            .attr("width", "100%")
            .attr("height", "100%")
            .append("g")
            .attr("id", "mini-map");

        miniMapLinks = miniMap.selectAll(".link").data(links);
        miniMapLinks.enter()
            .append("line")
            .attr("class", "link");

        miniMapNodes = miniMap.selectAll(".node").data(force.nodes());
        miniMapNodes.enter()
            .append("circle")
            .attr("class", "node")
            .attr("r", 20);

        force.on("end", scaleAndPositionMiniMap);
    }

    function updateMiniMap() {
        miniMapLinks
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);

        miniMapNodes
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);
    }

    function scaleAndPositionMiniMap() {
    if (isMiniMapScaled) return;
    isMiniMapScaled = true;

    d3.select("#bird-view svg").attr("opacity", 1.0);

    const containerDimensions = getDimensions("#bird-view");
    const miniMapDimensions = getDimensions("#mini-map");

    // Calculate uniform scale based on the smaller ratio (to fit within the container)
    const scale = Math.min(
        (containerDimensions.width * 0.75) / miniMapDimensions.width,
        (containerDimensions.height * 0.75) / miniMapDimensions.height
    );

    // Calculate translation to center the mini-map within the container
    const translateX = (containerDimensions.width - miniMapDimensions.width * scale) / 2;
    const translateY = (containerDimensions.height - miniMapDimensions.height * scale) / 2;

    // Apply the transformation
    const transformation = `translate(${translateX}, ${translateY}) scale(${scale})`;
    d3.select("#mini-map").attr("transform", transformation);
}


    function getDimensions(selector) {
        const rect = d3.select(selector).node().getBoundingClientRect();
        return { width: rect.width, height: rect.height };
    }

</script>